<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ‹è¯•åˆ›å»ºç”¨æˆ·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 20px auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      color: #333;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      padding: 10px 20px;
      margin: 10px 5px;
      font-size: 14px;
      cursor: pointer;
      background-color: #1890ff;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background-color: #40a9ff;
    }
    .danger {
      background-color: #ff4d4f;
    }
    .danger:hover {
      background-color: #ff7875;
    }
    pre {
      background-color: #fff;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      border: 1px solid #ddd;
    }
    .log {
      margin-top: 20px;
      background-color: #fff;
      padding: 15px;
      border-radius: 4px;
      border: 1px solid #ddd;
      max-height: 400px;
      overflow-y: auto;
    }
    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid #1890ff;
      padding-left: 10px;
    }
    .log-error {
      border-left-color: #ff4d4f;
      color: #ff4d4f;
    }
    .log-success {
      border-left-color: #52c41a;
      color: #52c41a;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª æµ‹è¯•åˆ›å»ºç”¨æˆ·åŠŸèƒ½</h1>
  
  <div class="form-group">
    <label>ç”¨æˆ·å§“åï¼š</label>
    <input type="text" id="name" value="æµ‹è¯•ç”¨æˆ·" placeholder="è¯·è¾“å…¥ç”¨æˆ·å§“å">
  </div>

  <div class="form-group">
    <label>é‚®ç®±åœ°å€ï¼š</label>
    <input type="email" id="email" value="test@example.com" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€">
  </div>

  <div class="form-group">
    <label>ç”¨æˆ·è§’è‰²ï¼š</label>
    <select id="role">
      <option value="">è¯·é€‰æ‹©</option>
      <option value="admin">ç®¡ç†å‘˜</option>
      <option value="moderator">åè°ƒå‘˜</option>
      <option value="user" selected>æ™®é€šç”¨æˆ·</option>
    </select>
  </div>

  <div class="form-group">
    <label>ç”¨æˆ·çŠ¶æ€ï¼š</label>
    <select id="status">
      <option value="">è¯·é€‰æ‹©</option>
      <option value="active" selected>æ¿€æ´»</option>
      <option value="inactive">æœªæ¿€æ´»</option>
      <option value="pending">å¾…å®¡æ ¸</option>
    </select>
  </div>

  <div>
    <button onclick="testCreateUser()">åˆ›å»ºç”¨æˆ·</button>
    <button onclick="checkUsers()">æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨</button>
    <button class="danger" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
  </div>

  <div class="log" id="logs"></div>

  <script type="module">
    import { getApiClient } from './src/services/apiClient.ts'
    import { getMockApiService, initializeMockApiService } from './src/services/mockApiService.ts'

    let logCount = 0

    function addLog(message, type = 'info') {
      const logsDiv = document.getElementById('logs')
      const logEntry = document.createElement('div')
      logEntry.className = `log-entry log-${type}`
      logEntry.textContent = `[${++logCount}] ${new Date().toLocaleTimeString()} - ${message}`
      logsDiv.appendChild(logEntry)
      logsDiv.scrollTop = logsDiv.scrollHeight
    }

    // åˆå§‹åŒ–
    initializeMockApiService()
    addLog('Mock API æœåŠ¡å·²åˆå§‹åŒ–', 'success')

    window.testCreateUser = async function() {
      const name = document.getElementById('name').value
      const email = document.getElementById('email').value
      const role = document.getElementById('role').value
      const status = document.getElementById('status').value

      addLog('å¼€å§‹åˆ›å»ºç”¨æˆ·...', 'info')
      addLog(`å§“å: ${name}`, 'info')
      addLog(`é‚®ç®±: ${email}`, 'info')
      addLog(`è§’è‰²: ${role}`, 'info')
      addLog(`çŠ¶æ€: ${status}`, 'info')

      // éªŒè¯è¾“å…¥
      if (!name || !email || !role || !status) {
        addLog('âŒ è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error')
        return
      }

      try {
        const apiClient = getApiClient()
        const userData = { name, email, role, status }

        addLog('å‘é€ API è¯·æ±‚...', 'info')
        const response = await apiClient.createUser(userData)
        
        addLog('âœ… ç”¨æˆ·åˆ›å»ºæˆåŠŸï¼', 'success')
        addLog(`ç”¨æˆ·ID: ${response.data.id}`, 'success')
        addLog(`å“åº”æ¶ˆæ¯: ${response.message}`, 'success')
        
        // è‡ªåŠ¨æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
        await window.checkUsers()

      } catch (error) {
        addLog(`âŒ åˆ›å»ºå¤±è´¥: ${error.message}`, 'error')
        
        if (error.response) {
          addLog(`çŠ¶æ€ç : ${error.response.status}`, 'error')
          if (error.response.data) {
            addLog(`é”™è¯¯æ¶ˆæ¯: ${error.response.data.message}`, 'error')
            if (error.response.data.errors) {
              error.response.data.errors.forEach(err => {
                addLog(`  - ${err}`, 'error')
              })
            }
          }
        }
        
        console.error('è¯¦ç»†é”™è¯¯:', error)
      }
    }

    window.checkUsers = async function() {
      try {
        addLog('è·å–ç”¨æˆ·åˆ—è¡¨...', 'info')
        const apiClient = getApiClient()
        const response = await apiClient.getUsers()
        
        addLog(`âœ… å½“å‰ç”¨æˆ·æ•°é‡: ${response.data.length}`, 'success')
        
        // æ˜¾ç¤ºæœ€å5ä¸ªç”¨æˆ·
        const lastUsers = response.data.slice(-5)
        addLog('æœ€å5ä¸ªç”¨æˆ·:', 'info')
        lastUsers.forEach((user, index) => {
          addLog(`  ${response.data.length - 4 + index}. ${user.name} (${user.email})`, 'info')
        })

      } catch (error) {
        addLog(`âŒ è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error')
        console.error('è¯¦ç»†é”™è¯¯:', error)
      }
    }

    window.clearLogs = function() {
      document.getElementById('logs').innerHTML = ''
      logCount = 0
      addLog('æ—¥å¿—å·²æ¸…ç©º', 'info')
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç”¨æˆ·åˆ—è¡¨
    window.checkUsers()
  </script>
</body>
</html>
