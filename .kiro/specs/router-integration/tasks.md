# 实施计划：路由集成

## 概述

本实施计划将 Vue Router 集成到现有的用户管理系统中，实现基于路由的页面导航功能。任务按照增量方式组织，每个步骤都建立在前一步的基础上，确保功能逐步完善并及时验证。

## 任务列表

- [x] 1. 安装依赖和创建基础路由配置
  - 安装 vue-router 4.x 到项目依赖
  - 创建 `src/router/index.ts` 文件
  - 创建 `src/types/router.ts` 类型定义文件
  - 定义路由元信息接口（RouteMeta）
  - 定义基础路由配置数组（暂时为空数组）
  - 创建路由器实例（使用 History 模式）
  - 导出路由器实例
  - _需求：1.1, 1.2, 1.3_

- [ ]* 1.1 编写路由配置单元测试
  - 测试路由器实例是否正确创建
  - 测试路由器是否使用 History 模式
  - _需求：1.4_

- [ ] 2. 创建主布局组件
  - [x] 2.1 创建 `src/layouts/MainLayout.vue` 组件
    - 实现顶部导航栏（使用 Ant Design Vue Layout 和 Menu）
    - 添加系统 Logo 和标题
    - 实现水平导航菜单（首页、用户管理）
    - 添加内容区域容器
    - 集成 RouterView 用于渲染路由组件
    - 实现路由切换动画（fade 效果）
    - 添加响应式样式（移动端和桌面端）
    - _需求：3.1, 3.2, 3.3, 3.4, 11.1, 11.2_
  
  - [ ]* 2.2 编写 MainLayout 组件单元测试
    - 测试组件是否包含顶部导航栏
    - 测试组件是否包含 RouterView
    - 测试导航菜单项是否正确渲染
    - _需求：3.2, 3.3, 3.4_

- [ ] 3. 创建页面视图组件
  - [x] 3.1 创建 `src/views/Home.vue` 首页组件
    - 实现欢迎卡片（使用 Ant Design Vue Card）
    - 显示系统标题和欢迎信息
    - 添加系统特性展示（使用 Grid 布局）
    - 添加快速导航链接到用户管理页面
    - 实现响应式布局
    - _需求：5.1, 5.2, 5.3_
  
  - [x] 3.2 创建 `src/views/Users.vue` 用户管理视图组件
    - 导入现有的 UserManagement 组件
    - 创建简单的包装组件渲染 UserManagement
    - _需求：6.2, 6.3_
  
  - [x] 3.3 创建 `src/views/NotFound.vue` 404 页面组件
    - 使用 Ant Design Vue Result 组件
    - 显示 404 状态和错误消息
    - 添加"返回首页"按钮
    - 添加"返回上一页"按钮
    - 实现按钮点击事件处理
    - _需求：7.1, 7.3, 7.4_
  
  - [ ]* 3.4 编写页面组件单元测试
    - 测试 Home 组件是否显示欢迎信息
    - 测试 Home 组件是否包含到用户管理的链接
    - 测试 NotFound 组件是否显示 404 消息
    - 测试 NotFound 组件是否包含返回按钮
    - _需求：5.2, 5.3, 7.3, 7.4_

- [x] 4. 配置路由映射
  - 在 `src/router/index.ts` 中定义完整的路由配置
  - 配置根路由（/）使用 MainLayout 作为父路由
  - 配置首页子路由（''）指向 Home 组件（懒加载）
  - 配置用户管理子路由（'users'）指向 Users 组件（懒加载）
  - 配置 404 路由（/:pathMatch(.*)*）指向 NotFound 组件（懒加载）
  - 为每个路由添加 meta 信息（title、icon）
  - _需求：2.1, 2.2, 2.3, 2.4, 2.5, 8.1, 8.2, 12.2_

- [ ]* 4.1 编写路由配置属性测试
  - **属性 1：路由配置完整性**
  - **验证需求：2.5**
  - 测试所有路由是否包含 path、name 和 component
  
- [ ]* 4.2 编写路由元信息属性测试
  - **属性 2：路由元信息完整性**
  - **验证需求：8.1, 8.2**
  - 测试所有路由的 meta 是否包含 title 属性

- [ ]* 4.3 编写路由配置单元测试
  - 测试根路由是否定义并指向首页
  - 测试用户管理路由是否定义
  - 测试 404 路由是否定义
  - 测试路由是否使用懒加载
  - _需求：2.1, 2.2, 2.3, 2.4_

- [x] 5. 实现路由导航守卫
  - 在 `src/router/index.ts` 中实现全局前置守卫（beforeEach）
  - 实现页面标题更新逻辑（从 meta.title 读取）
  - 实现开发环境导航日志记录
  - 确保守卫允许所有导航继续（调用 next()）
  - 添加错误处理（try-catch）
  - _需求：8.3, 8.4, 9.1, 9.2, 9.3, 9.4_

- [ ]* 5.1 编写导航守卫属性测试
  - **属性 7：页面标题同步**
  - **验证需求：8.3**
  - 测试路由切换时 document.title 是否更新
  
- [ ]* 5.2 编写导航守卫属性测试
  - **属性 8：导航守卫透明性**
  - **验证需求：9.4**
  - 测试所有路由导航是否被允许

- [ ]* 5.3 编写导航守卫单元测试
  - 测试开发环境是否记录导航日志
  - _需求：9.3_

- [x] 6. 实现路由错误处理
  - 在 `src/router/index.ts` 中实现路由错误处理器（onError）
  - 处理组件加载失败错误
  - 记录错误日志到控制台
  - _需求：错误处理_

- [ ] 7. 更新应用入口
  - [x] 7.1 更新 `src/App.vue`
    - 移除对 UserManagement 组件的直接导入和引用
    - 使用 `<router-view />` 替代直接渲染组件
    - 保持全局样式不变
    - _需求：6.4, 6.5_
  
  - [x] 7.2 更新 `src/main.ts`
    - 导入路由器实例
    - 使用 `app.use(router)` 注册路由器插件
    - 确保在 mount 之前注册
    - _需求：1.3_
  
  - [ ]* 7.3 编写 App.vue 单元测试
    - 测试 App.vue 是否使用 RouterView
    - _需求：6.5_

- [x] 8. 实现菜单激活状态同步
  - 在 `src/layouts/MainLayout.vue` 中实现菜单激活逻辑
  - 使用 `useRoute()` 监听当前路由
  - 根据当前路由路径更新 `selectedKeys`
  - 使用 `watch` 监听路由变化
  - _需求：4.3_

- [ ]* 8.1 编写菜单激活状态属性测试
  - **属性 4：菜单激活状态同步**
  - **验证需求：4.3**
  - 测试路由切换时菜单项是否正确高亮

- [x] 9. 检查点 - 基础路由功能验证
  - 手动测试：启动开发服务器，验证路由导航是否正常
  - 验证首页是否正确显示
  - 验证用户管理页面是否正确显示
  - 验证 404 页面是否正确显示
  - 验证浏览器 URL 是否正确更新
  - 验证浏览器后退/前进按钮是否正常工作
  - 验证页面标题是否正确更新
  - 如有问题，询问用户并解决

- [ ] 10. 集成测试 - 路由导航流程
  - [ ]* 10.1 编写导航流程集成测试
    - 测试完整的导航流程：首页 → 用户管理 → 首页
    - 测试 404 路由处理
    - 测试浏览器历史导航
    - _需求：4.1, 4.2, 4.4, 5.4, 7.2_
  
  - [ ]* 10.2 编写导航行为属性测试
    - **属性 3：导航行为一致性**
    - **验证需求：4.1, 4.2**
    - 测试导航到任何路由时 URL 和组件是否同步更新
  
  - [ ]* 10.3 编写浏览器历史导航属性测试
    - **属性 5：浏览器历史导航**
    - **验证需求：4.4**
    - 测试后退/前进操作是否正确导航
  
  - [ ]* 10.4 编写 404 路由属性测试
    - **属性 6：404 路由处理**
    - **验证需求：7.2**
    - 测试未定义路由是否显示 NotFound 组件

- [ ] 11. 集成测试 - 用户管理功能完整性
  - [ ]* 11.1 编写用户管理 CRUD 操作集成测试
    - **属性 9：用户管理功能完整性 - CRUD 操作**
    - **验证需求：10.1**
    - 在路由环境下测试创建、读取、更新、删除用户
    - 验证功能与非路由环境下完全一致
  
  - [ ]* 11.2 编写搜索筛选功能集成测试
    - **属性 10：用户管理功能完整性 - 搜索筛选**
    - **验证需求：10.2**
    - 在路由环境下测试搜索和筛选功能
  
  - [ ]* 11.3 编写数据持久化集成测试
    - **属性 11：用户管理功能完整性 - 数据持久化**
    - **验证需求：10.3**
    - 在路由环境下测试数据持久化到 localStorage
  
  - [ ]* 11.4 编写错误处理集成测试
    - **属性 12：用户管理功能完整性 - 错误处理**
    - **验证需求：10.4**
    - 在路由环境下测试错误处理逻辑
  
  - [ ]* 11.5 编写 API 集成测试
    - **属性 13：用户管理功能完整性 - API 集成**
    - **验证需求：10.5**
    - 在路由环境下测试 API 调用功能
  
  - [ ]* 11.6 编写布局持久性属性测试
    - **属性 14：布局组件持久性**
    - **验证需求：3.5**
    - 测试路由切换时 Layout 组件是否保持渲染

- [x] 12. 最终检查点 - 完整功能验证
  - 运行所有测试，确保测试通过
  - 手动测试所有路由和功能
  - 验证响应式布局在移动端和桌面端的表现
  - 验证所有用户管理功能在路由环境下正常工作
  - 检查浏览器控制台是否有错误
  - 如有问题，询问用户并解决

## 注意事项

- 标记 `*` 的任务为可选测试任务，可以跳过以加快 MVP 开发
- 每个任务都引用了具体的需求编号，便于追溯
- 属性测试必须使用 fast-check 库，最少 100 次迭代
- 所有测试必须在测试名称或注释中引用设计文档中的属性编号
- 检查点任务用于确保增量验证，及时发现问题
- 保持现有用户管理功能完整性是最高优先级
