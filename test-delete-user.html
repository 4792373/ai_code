<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ‹è¯•åˆ é™¤ç”¨æˆ·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      color: #333;
    }
    .controls {
      margin: 20px 0;
      padding: 15px;
      background-color: #fff;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 14px;
      cursor: pointer;
      background-color: #1890ff;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background-color: #40a9ff;
    }
    .danger {
      background-color: #ff4d4f;
    }
    .danger:hover {
      background-color: #ff7875;
    }
    .user-list {
      background-color: #fff;
      padding: 15px;
      border-radius: 4px;
      border: 1px solid #ddd;
      margin-top: 20px;
    }
    .user-item {
      padding: 10px;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .user-item:last-child {
      border-bottom: none;
    }
    .user-info {
      flex: 1;
    }
    .log {
      margin-top: 20px;
      background-color: #fff;
      padding: 15px;
      border-radius: 4px;
      border: 1px solid #ddd;
      max-height: 400px;
      overflow-y: auto;
    }
    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid #1890ff;
      padding-left: 10px;
    }
    .log-error {
      border-left-color: #ff4d4f;
      color: #ff4d4f;
    }
    .log-success {
      border-left-color: #52c41a;
      color: #52c41a;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª æµ‹è¯•åˆ é™¤ç”¨æˆ·åŠŸèƒ½</h1>
  
  <div class="controls">
    <button onclick="loadUsers()">åˆ·æ–°ç”¨æˆ·åˆ—è¡¨</button>
    <button onclick="checkLocalStorage()">æ£€æŸ¥ LocalStorage</button>
    <button class="danger" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
  </div>

  <div class="user-list" id="userList">
    <p>åŠ è½½ä¸­...</p>
  </div>

  <div class="log" id="logs"></div>

  <script type="module">
    import { getApiClient } from './src/services/apiClient.ts'
    import { getMockApiService, initializeMockApiService } from './src/services/mockApiService.ts'

    let logCount = 0
    let users = []

    function addLog(message, type = 'info') {
      const logsDiv = document.getElementById('logs')
      const logEntry = document.createElement('div')
      logEntry.className = `log-entry log-${type}`
      logEntry.textContent = `[${++logCount}] ${new Date().toLocaleTimeString()} - ${message}`
      logsDiv.appendChild(logEntry)
      logsDiv.scrollTop = logsDiv.scrollHeight
    }

    // åˆå§‹åŒ–
    initializeMockApiService()
    addLog('Mock API æœåŠ¡å·²åˆå§‹åŒ–', 'success')

    async function loadUsers() {
      try {
        addLog('æ­£åœ¨åŠ è½½ç”¨æˆ·åˆ—è¡¨...', 'info')
        const apiClient = getApiClient()
        const response = await apiClient.getUsers()
        
        users = response.data
        addLog(`âœ… æˆåŠŸåŠ è½½ ${users.length} ä¸ªç”¨æˆ·`, 'success')
        
        renderUserList()
      } catch (error) {
        addLog(`âŒ åŠ è½½å¤±è´¥: ${error.message}`, 'error')
        console.error('åŠ è½½é”™è¯¯:', error)
      }
    }

    function renderUserList() {
      const userListDiv = document.getElementById('userList')
      
      if (users.length === 0) {
        userListDiv.innerHTML = '<p>æš‚æ— ç”¨æˆ·</p>'
        return
      }

      userListDiv.innerHTML = `
        <h3>ç”¨æˆ·åˆ—è¡¨ï¼ˆå…± ${users.length} ä¸ªç”¨æˆ·ï¼‰</h3>
        ${users.map((user, index) => `
          <div class="user-item">
            <div class="user-info">
              <strong>${index + 1}. ${user.name}</strong> - ${user.email}
              <br>
              <small>ID: ${user.id} | è§’è‰²: ${user.role} | çŠ¶æ€: ${user.status}</small>
            </div>
            <button class="danger" onclick="deleteUser('${user.id}', '${user.name}')">åˆ é™¤</button>
          </div>
        `).join('')}
      `
    }

    window.deleteUser = async function(userId, userName) {
      if (!confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· "${userName}" å—ï¼Ÿ`)) {
        return
      }

      try {
        addLog(`æ­£åœ¨åˆ é™¤ç”¨æˆ·: ${userName} (${userId})`, 'info')
        
        const apiClient = getApiClient()
        await apiClient.deleteUser(userId)
        
        addLog(`âœ… ç”¨æˆ·åˆ é™¤æˆåŠŸ: ${userName}`, 'success')
        
        // é‡æ–°åŠ è½½ç”¨æˆ·åˆ—è¡¨
        await loadUsers()
        
        // æ£€æŸ¥ localStorage
        await checkLocalStorage()
        
      } catch (error) {
        addLog(`âŒ åˆ é™¤å¤±è´¥: ${error.message}`, 'error')
        
        if (error.response) {
          addLog(`çŠ¶æ€ç : ${error.response.status}`, 'error')
          if (error.response.data) {
            addLog(`é”™è¯¯æ¶ˆæ¯: ${error.response.data.message}`, 'error')
          }
        }
        
        console.error('åˆ é™¤é”™è¯¯:', error)
      }
    }

    window.checkLocalStorage = async function() {
      try {
        const stored = localStorage.getItem('mock_api_users')
        if (stored) {
          const data = JSON.parse(stored)
          addLog(`LocalStorage ä¸­æœ‰ ${data.users?.length || 0} ä¸ªç”¨æˆ·`, 'info')
        } else {
          addLog('LocalStorage ä¸­æ²¡æœ‰æ•°æ®', 'info')
        }
      } catch (error) {
        addLog(`æ£€æŸ¥ LocalStorage å¤±è´¥: ${error.message}`, 'error')
      }
    }

    window.loadUsers = loadUsers
    window.clearLogs = function() {
      document.getElementById('logs').innerHTML = ''
      logCount = 0
      addLog('æ—¥å¿—å·²æ¸…ç©º', 'info')
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½ç”¨æˆ·åˆ—è¡¨
    loadUsers()
  </script>
</body>
</html>
